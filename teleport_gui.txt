-- teleport_gui.lua
-- Full Teleport GUI Script

local player = game.Players.LocalPlayer
local UIS = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local teleportPoint = nil
local minimized = false

-- helper tween function
local function tween(obj, time, props)
    TweenService:Create(obj, TweenInfo.new(time, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), props):Play()
end

-- ScreenGui
local gui = Instance.new("ScreenGui")
gui.Name = "TeleportUI"
gui.ResetOnSpawn = false
gui.IgnoreGuiInset = true
gui.ZIndexBehavior = Enum.ZIndexBehavior.Global
gui.Parent = player:WaitForChild("PlayerGui")

-- Main Frame
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 310, 0, 210)
mainFrame.Position = UDim2.new(0.5, -155, 0.5, -105)
mainFrame.BackgroundColor3 = Color3.fromRGB(28, 28, 38)
mainFrame.Active = true
mainFrame.Parent = gui
Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0,12)

-- Gradient & Shadow
local gradient = Instance.new("UIGradient", mainFrame)
gradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(55,55,80)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(15,15,25))
}
gradient.Rotation = 90

local shadow = Instance.new("ImageLabel")
shadow.Image = "rbxassetid://6015897843"
shadow.ScaleType = Enum.ScaleType.Slice
shadow.SliceCenter = Rect.new(49,49,450,450)
shadow.Size = UDim2.new(1,50,1,50)
shadow.Position = UDim2.new(0.5,0,0.5,0)
shadow.AnchorPoint = Vector2.new(0.5,0.5)
shadow.ImageTransparency = 0.6
shadow.BackgroundTransparency = 1
shadow.ZIndex = 0
shadow.Parent = mainFrame

-- Top Bar
local topBar = Instance.new("Frame")
topBar.Size = UDim2.new(1,0,0,36)
topBar.BackgroundColor3 = Color3.fromRGB(40,40,55)
topBar.Parent = mainFrame
Instance.new("UICorner", topBar).CornerRadius = UDim.new(0,12)

local title = Instance.new("TextLabel")
title.Text = "Teleport Control"
title.Font = Enum.Font.GothamBold
title.TextColor3 = Color3.fromRGB(255,255,255)
title.TextSize = 18
title.BackgroundTransparency = 1
title.Position = UDim2.new(0,10,0,0)
title.Size = UDim2.new(1,-90,1,0)
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = topBar

-- Close & Minimize
local closeBtn = Instance.new("TextButton")
closeBtn.Text = "X"
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextColor3 = Color3.fromRGB(255,255,255)
closeBtn.TextSize = 18
closeBtn.Size = UDim2.new(0,35,1,0)
closeBtn.Position = UDim2.new(1,-35,0,0)
closeBtn.BackgroundTransparency = 1
closeBtn.Parent = topBar

local minimizeBtn = Instance.new("TextButton")
minimizeBtn.Text = "â€“"
minimizeBtn.Font = Enum.Font.GothamBold
minimizeBtn.TextColor3 = Color3.fromRGB(255,255,150)
minimizeBtn.TextSize = 26
minimizeBtn.Size = UDim2.new(0,35,1,0)
minimizeBtn.Position = UDim2.new(1,-70,0,0)
minimizeBtn.BackgroundTransparency = 1
minimizeBtn.Parent = topBar

-- Buttons holder
local holder = Instance.new("Frame")
holder.Size = UDim2.new(1,0,1,-40)
holder.Position = UDim2.new(0,0,0,40)
holder.BackgroundTransparency = 1
holder.Parent = mainFrame

local layout = Instance.new("UIListLayout", holder)
layout.Padding = UDim.new(0,12)
layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
layout.VerticalAlignment = Enum.VerticalAlignment.Center

-- Button factory with thin black stroke
local function createButton(text, c1, c2)
    local b = Instance.new("TextButton")
    b.Text = text
    b.Size = UDim2.new(0,230,0,45)
    b.Font = Enum.Font.GothamBold
    b.TextSize = 17
    b.TextColor3 = Color3.new(1,1,1)
    b.TextStrokeColor3 = Color3.fromRGB(0,0,0)
    b.TextStrokeTransparency = 0.6
    b.BackgroundColor3 = c1
    b.AutoButtonColor = false
    Instance.new("UICorner", b).CornerRadius = UDim.new(0,10)
    local grad = Instance.new("UIGradient", b)
    grad.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, c1),
        ColorSequenceKeypoint.new(1, c2)
    }
    grad.Rotation = 90
    b.Parent = holder

    b.MouseEnter:Connect(function()
        tween(b, 0.12, {Size = UDim2.new(0,240,0,50)})
    end)
    b.MouseLeave:Connect(function()
        tween(b, 0.12, {Size = UDim2.new(0,230,0,45)})
    end)

    return b
end

local placeBtn = createButton("Place Teleport Point", Color3.fromRGB(0,170,255), Color3.fromRGB(0,110,255))
local tpBtn    = createButton("Teleport to Point", Color3.fromRGB(0,255,150), Color3.fromRGB(0,180,100))

-- Notification UI
local notifFrame = Instance.new("Frame")
notifFrame.Size = UDim2.new(0,300,0,45)
notifFrame.BackgroundColor3 = Color3.fromRGB(40,40,55)
notifFrame.BackgroundTransparency = 1
notifFrame.Visible = false
notifFrame.ZIndex = 2000
Instance.new("UICorner", notifFrame).CornerRadius = UDim.new(0,10)
notifFrame.Parent = gui

local notifLabel = Instance.new("TextLabel")
notifLabel.Size = UDim2.new(1,0,1,0)
notifLabel.Font = Enum.Font.Gotham
notifLabel.TextColor3 = Color3.fromRGB(255,255,255)
notifLabel.TextSize = 16
notifLabel.TextTransparency = 1
notifLabel.BackgroundTransparency = 1
notifLabel.ZIndex = 2001
notifLabel.Parent = notifFrame

-- Find inventory GUI
local function findInventoryGui()
    for _,v in ipairs(player:WaitForChild("PlayerGui"):GetDescendants()) do
        if v:IsA("GuiObject") then
            local name = v.Name:lower()
            if name:find("mostinventory") or name:find("inventory") then
                if v.Visible and v.AbsoluteSize and v.AbsoluteSize.Magnitude > 0 then
                    return v
                end
            end
        end
    end
    return nil
end

-- Notification function
local function notify(message)
    notifLabel.Text = message
    notifFrame.Visible = true

    local fallbackPos = UDim2.new(0.5, -150, 0.85, 0)
    local inv = findInventoryGui()
    if inv then
        local invPos = inv.AbsolutePosition
        local invSize = inv.AbsoluteSize
        local notifW, notifH = 300, 45
        local x = invPos.X + (invSize.X - notifW)/2
        local y = invPos.Y - notifH - 8
        local viewport = workspace.CurrentCamera.ViewportSize
        if x < 8 then x = 8 end
        if x + notifW > viewport.X - 8 then x = viewport.X - notifW - 8 end
        if y < 8 then y = invPos.Y + invSize.Y + 8 end
        notifFrame.AnchorPoint = Vector2.new(0,0)
        notifFrame.Position = UDim2.new(0, x, 0, y)
    else
        notifFrame.AnchorPoint = Vector2.new(0,0)
        notifFrame.Position = fallbackPos
    end

    notifFrame.BackgroundTransparency = 1
    notifLabel.TextTransparency = 1
    tween(notifFrame, 0.22, {BackgroundTransparency = 0.08})
    tween(notifLabel, 0.22, {TextTransparency = 0})
    task.wait(2.5)
    tween(notifLabel, 0.25, {TextTransparency = 1})
    tween(notifFrame, 0.35, {BackgroundTransparency = 1})
    task.wait(0.35)
    notifFrame.Visible = false
end

-- Draggable via top bar
do
    local dragging, dragStart, startPos
    topBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = mainFrame.Position
        end
    end)
    topBar.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    UIS.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            local goal = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
            tween(mainFrame, 0.08, {Position = goal})
        end
    end)
end

-- Teleport logic
placeBtn.MouseButton1Click:Connect(function()
    local char = player.Character or player.CharacterAdded:Wait()
    local root = char:WaitForChild("HumanoidRootPart")
    if teleportPoint then teleportPoint:Destroy() end

    local point = Instance.new("Part")
    point.Size = Vector3.new(2,1,2)
    point.Anchored = true
    point.CanCollide = false
    point.Material = Enum.Material.Neon
    point.Color = Color3.fromRGB(0,255,120)
    point.CFrame = root.CFrame * CFrame.new(0, -3, 0)
    point.Name = "TeleportPoint"
    point.Parent = workspace
    teleportPoint = point

    notify("Teleport point placed!")
end)

tpBtn.MouseButton1Click:Connect(function()
    if teleportPoint and teleportPoint.Parent then
        local char = player.Character or player.CharacterAdded:Wait()
        local root = char:WaitForChild("HumanoidRootPart")
        root.CFrame = teleportPoint.CFrame + Vector3.new(0,3,0)
        notify("Teleported successfully!")
    else
        notify("No teleport point found!")
    end
end)

-- Close / Minimize
closeBtn.MouseButton1Click:Connect(function()
    if teleportPoint and teleportPoint.Parent then
        teleportPoint:Destroy()
        teleportPoint = nil
    end
    gui:Destroy()
end)

minimizeBtn.MouseButton1Click:Connect(function()
    mainFrame.Visible = false
    minimized = true
    notify("Press Shift to reopen Teleport UI")
end)

-- Shift reopen
UIS.InputBegan:Connect(function(input, processed)
    if processed then return end
    if minimized and (input.KeyCode == Enum.KeyCode.LeftShift or input.KeyCode == Enum.KeyCode.RightShift) then
        mainFrame.Visible = true
        minimized = false
        notify("Teleport UI reopened")
    end
end)
